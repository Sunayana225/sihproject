<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡§∏‡•ç‡§µ‡§æ‡§∏‡•ç‡§•‡•ç‡§Ø ‡§Æ‡§ø‡§§‡•ç‡§∞ - Health Companion</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .chat-container {
            width: 100%;
            max-width: 800px;
            height: 90vh;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            backdrop-filter: blur(10px);
        }

        .chat-header {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
        }

        .header-title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .header-subtitle {
            font-size: 14px;
            opacity: 0.9;
        }

        .language-toggle {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
        }

        .language-toggle:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            background: #f8f9fa;
            position: relative;
        }

        .message {
            margin-bottom: 20px;
            display: flex;
            align-items: flex-start;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.user {
            justify-content: flex-end;
        }

        .message.bot {
            justify-content: flex-start;
        }

        .message-content {
            max-width: 70%;
            padding: 15px 20px;
            border-radius: 20px;
            font-size: 14px;
            line-height: 1.6;
            position: relative;
        }

        .message.user .message-content {
            background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%);
            color: white;
            border-bottom-right-radius: 5px;
        }

        .message.bot .message-content {
            background: white;
            color: #333;
            border: 1px solid #e0e0e0;
            border-bottom-left-radius: 5px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            margin: 0 10px;
            flex-shrink: 0;
        }

        .message.user .avatar {
            background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%);
            color: white;
            order: 2;
        }

        .message.bot .avatar {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
        }

        .quick-options {
            padding: 10px 20px;
            background: white;
            border-top: 1px solid #e0e0e0;
        }

        .quick-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 15px;
        }

        .quick-btn {
            background: linear-gradient(135deg, #FF9800 0%, #F57C00 100%);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .quick-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .chat-input-container {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .chat-input {
            flex: 1;
            padding: 12px 20px;
            border: 2px solid #e0e0e0;
            border-radius: 25px;
            font-size: 14px;
            outline: none;
            transition: all 0.3s ease;
        }

        .chat-input:focus {
            border-color: #4CAF50;
            box-shadow: 0 0 10px rgba(76, 175, 80, 0.2);
        }

        .send-btn {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            border: none;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .send-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .send-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .typing-indicator {
            display: none;
            padding: 15px 20px;
            font-style: italic;
            color: #666;
        }

        .typing-dots {
            display: inline-block;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0%, 60%, 100% { opacity: 1; }
            30% { opacity: 0.3; }
        }

        .emergency-banner {
            background: linear-gradient(135deg, #f44336 0%, #d32f2f 100%);
            color: white;
            padding: 10px 20px;
            text-align: center;
            font-size: 12px;
            font-weight: bold;
        }

        .health-card {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            border: 1px solid #2196F3;
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
        }

        .health-card h4 {
            color: #1976D2;
            margin-bottom: 8px;
        }

        .health-card ul {
            margin-left: 20px;
            color: #333;
        }

        .vaccination-schedule {
            background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);
            border: 1px solid #FF9800;
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
        }

        .vaccination-schedule h4 {
            color: #F57C00;
            margin-bottom: 8px;
        }

        @media (max-width: 768px) {
            .chat-container {
                height: 100vh;
                border-radius: 0;
            }
            
            .message-content {
                max-width: 85%;
            }
            
            .header-title {
                font-size: 20px;
            }
            
            .language-toggle {
                position: static;
                transform: none;
                margin-top: 10px;
            }
        }

        .connection-status {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #4CAF50;
            animation: pulse 2s infinite;
        }

        .connection-status.offline {
            background: #f44336;
        }
    </style>
</head>
<body>
    <div class="chat-container">
        <div class="emergency-banner" id="emergencyBanner">
            üö® For medical emergencies, call 108 immediately | ‡§Ü‡§™‡§æ‡§§‡§ï‡§æ‡§≤ ‡§Æ‡•á‡§Ç ‡§§‡•Å‡§∞‡§Ç‡§§ 108 ‡§™‡§∞ ‡§ï‡•â‡§≤ ‡§ï‡§∞‡•á‡§Ç
        </div>
        
        <div class="chat-header">
            <div class="connection-status" id="connectionStatus"></div>
            <div class="header-title" id="headerTitle">‡§∏‡•ç‡§µ‡§æ‡§∏‡•ç‡§•‡•ç‡§Ø ‡§Æ‡§ø‡§§‡•ç‡§∞ - Health Companion</div>
            <div class="header-subtitle" id="headerSubtitle">Your AI-powered healthcare education assistant</div>
            <button class="language-toggle" id="languageToggle" onclick="toggleLanguage()">‡§π‡§ø‡§Ç/EN</button>
        </div>

        <div class="chat-messages" id="chatMessages">
        </div>

        <div class="typing-indicator" id="typingIndicator">
            <span class="typing-dots">AI is thinking...</span>
        </div>

        <div class="quick-options">
            <div class="quick-buttons" id="quickButtons">
            </div>
            
            <div class="chat-input-container">
                <input 
                    type="text" 
                    id="chatInput" 
                    class="chat-input" 
                    placeholder="Ask about symptoms, vaccination, or health tips..."
                    onkeypress="handleKeyPress(event)"
                >
                <button class="send-btn" id="sendBtn" onclick="sendMessage()">
                    ‚û§
                </button>
            </div>
        </div>
    </div>

    <script>
        let isHindi = false;
        let chatHistory = [];
        let isConnected = false;

        const content = {
            en: {
                headerTitle: "Health Companion",
                headerSubtitle: "Your AI-powered healthcare education assistant",
                inputPlaceholder: "Ask about symptoms, vaccination, or health tips...",
                welcomeMessage: "Hello! I'm your Health Companion. I can help you with:\n‚Ä¢ Disease symptoms and prevention\n‚Ä¢ Vaccination schedules\n‚Ä¢ General health advice\n‚Ä¢ First aid information\n\nHow can I assist you today?",
                quickButtons: [
                    "Common Cold Symptoms",
                    "Child Vaccination",
                    "Diabetes Prevention",
                    "Blood Pressure",
                    "First Aid Tips"
                ],
                typingText: "AI is thinking...",
                emergencyText: "üö® For medical emergencies, call 108 immediately"
            },
            hi: {
                headerTitle: "‡§∏‡•ç‡§µ‡§æ‡§∏‡•ç‡§•‡•ç‡§Ø ‡§Æ‡§ø‡§§‡•ç‡§∞",
                headerSubtitle: "‡§Ü‡§™‡§ï‡§æ AI-‡§∏‡§Ç‡§ö‡§æ‡§≤‡§ø‡§§ ‡§∏‡•ç‡§µ‡§æ‡§∏‡•ç‡§•‡•ç‡§Ø ‡§∂‡§ø‡§ï‡•ç‡§∑‡§æ ‡§∏‡§π‡§æ‡§Ø‡§ï",
                inputPlaceholder: "‡§≤‡§ï‡•ç‡§∑‡§£, ‡§ü‡•Ä‡§ï‡§æ‡§ï‡§∞‡§£, ‡§Ø‡§æ ‡§∏‡•ç‡§µ‡§æ‡§∏‡•ç‡§•‡•ç‡§Ø ‡§∏‡•Å‡§ù‡§æ‡§µ‡•ã‡§Ç ‡§ï‡•á ‡§¨‡§æ‡§∞‡•á ‡§Æ‡•á‡§Ç ‡§™‡•Ç‡§õ‡•á‡§Ç...",
                welcomeMessage: "‡§®‡§Æ‡§∏‡•ç‡§§‡•á! ‡§Æ‡•à‡§Ç ‡§Ü‡§™‡§ï‡§æ ‡§∏‡•ç‡§µ‡§æ‡§∏‡•ç‡§•‡•ç‡§Ø ‡§Æ‡§ø‡§§‡•ç‡§∞ ‡§π‡•Ç‡§Ç‡•§ ‡§Æ‡•à‡§Ç ‡§Ü‡§™‡§ï‡•Ä ‡§Æ‡§¶‡§¶ ‡§ï‡§∞ ‡§∏‡§ï‡§§‡§æ ‡§π‡•Ç‡§Ç:\n‚Ä¢ ‡§∞‡•ã‡§ó ‡§ï‡•á ‡§≤‡§ï‡•ç‡§∑‡§£ ‡§î‡§∞ ‡§¨‡§ö‡§æ‡§µ\n‚Ä¢ ‡§ü‡•Ä‡§ï‡§æ‡§ï‡§∞‡§£ ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ\n‚Ä¢ ‡§∏‡§æ‡§Æ‡§æ‡§®‡•ç‡§Ø ‡§∏‡•ç‡§µ‡§æ‡§∏‡•ç‡§•‡•ç‡§Ø ‡§∏‡§≤‡§æ‡§π\n‚Ä¢ ‡§™‡•ç‡§∞‡§æ‡§•‡§Æ‡§ø‡§ï ‡§ö‡§ø‡§ï‡§ø‡§§‡•ç‡§∏‡§æ ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä\n\n‡§Ü‡§ú ‡§Æ‡•à‡§Ç ‡§Ü‡§™‡§ï‡•Ä ‡§ï‡•à‡§∏‡•á ‡§∏‡§π‡§æ‡§Ø‡§§‡§æ ‡§ï‡§∞ ‡§∏‡§ï‡§§‡§æ ‡§π‡•Ç‡§Ç?",
                quickButtons: [
                    "‡§∏‡§∞‡•ç‡§¶‡•Ä ‡§ï‡•á ‡§≤‡§ï‡•ç‡§∑‡§£",
                    "‡§¨‡§ö‡•ç‡§ö‡•ã‡§Ç ‡§ï‡§æ ‡§ü‡•Ä‡§ï‡§æ‡§ï‡§∞‡§£",
                    "‡§Æ‡§ß‡•Å‡§Æ‡•á‡§π ‡§ï‡•Ä ‡§∞‡•ã‡§ï‡§•‡§æ‡§Æ",
                    "‡§∞‡§ï‡•ç‡§§‡§ö‡§æ‡§™",
                    "‡§™‡•ç‡§∞‡§æ‡§•‡§Æ‡§ø‡§ï ‡§ö‡§ø‡§ï‡§ø‡§§‡•ç‡§∏‡§æ"
                ],
                typingText: "AI ‡§∏‡•ã‡§ö ‡§∞‡§π‡§æ ‡§π‡•à...",
                emergencyText: "üö® ‡§Ü‡§™‡§æ‡§§‡§ï‡§æ‡§≤ ‡§Æ‡•á‡§Ç ‡§§‡•Å‡§∞‡§Ç‡§§ 108 ‡§™‡§∞ ‡§ï‡•â‡§≤ ‡§ï‡§∞‡•á‡§Ç"
            }
        };

        const healthDatabase = {
            symptoms: {
                "cold": {
                    en: "Common cold symptoms include runny nose, sneezing, cough, and mild fever. Rest, stay hydrated, and consult a doctor if symptoms persist.",
                    hi: "‡§∏‡§æ‡§Æ‡§æ‡§®‡•ç‡§Ø ‡§∏‡§∞‡•ç‡§¶‡•Ä ‡§ï‡•á ‡§≤‡§ï‡•ç‡§∑‡§£‡•ã‡§Ç ‡§Æ‡•á‡§Ç ‡§¨‡§π‡§§‡•Ä ‡§®‡§æ‡§ï, ‡§õ‡•Ä‡§Ç‡§ï, ‡§ñ‡§æ‡§Ç‡§∏‡•Ä ‡§î‡§∞ ‡§π‡§≤‡•ç‡§ï‡§æ ‡§¨‡•Å‡§ñ‡§æ‡§∞ ‡§∂‡§æ‡§Æ‡§ø‡§≤ ‡§π‡•à‡•§ ‡§Ü‡§∞‡§æ‡§Æ ‡§ï‡§∞‡•á‡§Ç, ‡§™‡§æ‡§®‡•Ä ‡§™‡§ø‡§è‡§Ç, ‡§î‡§∞ ‡§Ø‡§¶‡§ø ‡§≤‡§ï‡•ç‡§∑‡§£ ‡§¨‡§®‡•á ‡§∞‡§π‡•á‡§Ç ‡§§‡•ã ‡§°‡•â‡§ï‡•ç‡§ü‡§∞ ‡§∏‡•á ‡§∏‡§≤‡§æ‡§π ‡§≤‡•á‡§Ç‡•§"
                },
                "fever": {
                    en: "Fever is body temperature above 100.4¬∞F (38¬∞C). Common causes include infections. Seek medical attention if fever exceeds 103¬∞F or lasts more than 3 days.",
                    hi: "‡§¨‡•Å‡§ñ‡§æ‡§∞ ‡§ï‡§æ ‡§Æ‡§§‡§≤‡§¨ ‡§∂‡§∞‡•Ä‡§∞ ‡§ï‡§æ ‡§§‡§æ‡§™‡§Æ‡§æ‡§® 100.4¬∞F (38¬∞C) ‡§∏‡•á ‡§ä‡§™‡§∞ ‡§π‡•ã‡§®‡§æ ‡§π‡•à‡•§ ‡§∏‡§æ‡§Æ‡§æ‡§®‡•ç‡§Ø ‡§ï‡§æ‡§∞‡§£‡•ã‡§Ç ‡§Æ‡•á‡§Ç ‡§∏‡§Ç‡§ï‡•ç‡§∞‡§Æ‡§£ ‡§∂‡§æ‡§Æ‡§ø‡§≤ ‡§π‡•à‡•§ ‡§Ø‡§¶‡§ø ‡§¨‡•Å‡§ñ‡§æ‡§∞ 103¬∞F ‡§∏‡•á ‡§Ö‡§ß‡§ø‡§ï ‡§π‡•ã ‡§Ø‡§æ 3 ‡§¶‡§ø‡§® ‡§∏‡•á ‡§Ö‡§ß‡§ø‡§ï ‡§∞‡§π‡•á ‡§§‡•ã ‡§ö‡§ø‡§ï‡§ø‡§§‡•ç‡§∏‡§æ ‡§∏‡§π‡§æ‡§Ø‡§§‡§æ ‡§≤‡•á‡§Ç‡•§"
                }
            },
            vaccination: {
                "child": {
                    en: "Child vaccination schedule:\n‚Ä¢ Birth: BCG, Hepatitis B\n‚Ä¢ 6 weeks: DPT, Polio, Hepatitis B\n‚Ä¢ 10 weeks: DPT, Polio\n‚Ä¢ 14 weeks: DPT, Polio\n‚Ä¢ 9 months: Measles\n‚Ä¢ 15 months: MMR",
                    hi: "‡§¨‡§ö‡•ç‡§ö‡•ã‡§Ç ‡§ï‡•á ‡§ü‡•Ä‡§ï‡§æ‡§ï‡§∞‡§£ ‡§ï‡§æ ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ:\n‚Ä¢ ‡§ú‡§®‡•ç‡§Æ ‡§ï‡•á ‡§∏‡§Æ‡§Ø: BCG, ‡§π‡•á‡§™‡•á‡§ü‡§æ‡§á‡§ü‡§ø‡§∏ B\n‚Ä¢ 6 ‡§∏‡§™‡•ç‡§§‡§æ‡§π: DPT, ‡§™‡•ã‡§≤‡§ø‡§Ø‡•ã, ‡§π‡•á‡§™‡•á‡§ü‡§æ‡§á‡§ü‡§ø‡§∏ B\n‚Ä¢ 10 ‡§∏‡§™‡•ç‡§§‡§æ‡§π: DPT, ‡§™‡•ã‡§≤‡§ø‡§Ø‡•ã\n‚Ä¢ 14 ‡§∏‡§™‡•ç‡§§‡§æ‡§π: DPT, ‡§™‡•ã‡§≤‡§ø‡§Ø‡•ã\n‚Ä¢ 9 ‡§Æ‡§π‡•Ä‡§®‡•á: ‡§ñ‡§∏‡§∞‡§æ\n‚Ä¢ 15 ‡§Æ‡§π‡•Ä‡§®‡•á: MMR"
                }
            },
            prevention: {
                "diabetes": {
                    en: "Diabetes prevention tips:\n‚Ä¢ Maintain healthy weight\n‚Ä¢ Exercise regularly (30 min/day)\n‚Ä¢ Eat balanced diet with less sugar\n‚Ä¢ Regular health checkups\n‚Ä¢ Avoid smoking and excessive alcohol",
                    hi: "‡§Æ‡§ß‡•Å‡§Æ‡•á‡§π ‡§ï‡•Ä ‡§∞‡•ã‡§ï‡§•‡§æ‡§Æ ‡§ï‡•á ‡§â‡§™‡§æ‡§Ø:\n‚Ä¢ ‡§∏‡•ç‡§µ‡§∏‡•ç‡§• ‡§µ‡§ú‡§® ‡§¨‡§®‡§æ‡§è ‡§∞‡§ñ‡•á‡§Ç\n‚Ä¢ ‡§®‡§ø‡§Ø‡§Æ‡§ø‡§§ ‡§µ‡•ç‡§Ø‡§æ‡§Ø‡§æ‡§Æ ‡§ï‡§∞‡•á‡§Ç (30 ‡§Æ‡§ø‡§®‡§ü/‡§¶‡§ø‡§®)\n‚Ä¢ ‡§ï‡§Æ ‡§ö‡•Ä‡§®‡•Ä ‡§ï‡•á ‡§∏‡§æ‡§• ‡§∏‡§Ç‡§§‡•Å‡§≤‡§ø‡§§ ‡§Ü‡§π‡§æ‡§∞ ‡§≤‡•á‡§Ç\n‚Ä¢ ‡§®‡§ø‡§Ø‡§Æ‡§ø‡§§ ‡§∏‡•ç‡§µ‡§æ‡§∏‡•ç‡§•‡•ç‡§Ø ‡§ú‡§æ‡§Ç‡§ö ‡§ï‡§∞‡§æ‡§è‡§Ç\n‚Ä¢ ‡§ß‡•Ç‡§Æ‡•ç‡§∞‡§™‡§æ‡§® ‡§î‡§∞ ‡§Ö‡§ß‡§ø‡§ï ‡§∂‡§∞‡§æ‡§¨ ‡§∏‡•á ‡§¨‡§ö‡•á‡§Ç"
                }
            }
        };

        function initializeChatbot() {
            updateLanguage();
            addBotMessage(getCurrentContent().welcomeMessage);
            updateQuickButtons();
            
            setTimeout(() => {
                isConnected = true;
                document.getElementById('connectionStatus').classList.remove('offline');
            }, 2000);
        }

        function toggleLanguage() {
            isHindi = !isHindi;
            updateLanguage();
            updateQuickButtons();
        }

        function updateLanguage() {
            const currentContent = getCurrentContent();
            document.getElementById('headerTitle').textContent = currentContent.headerTitle;
            document.getElementById('headerSubtitle').textContent = currentContent.headerSubtitle;
            document.getElementById('chatInput').placeholder = currentContent.inputPlaceholder;
            document.getElementById('emergencyBanner').innerHTML = currentContent.emergencyText;
        }

        function getCurrentContent() {
            return isHindi ? content.hi : content.en;
        }

        function updateQuickButtons() {
            const quickButtonsContainer = document.getElementById('quickButtons');
            const currentContent = getCurrentContent();
            
            quickButtonsContainer.innerHTML = '';
            currentContent.quickButtons.forEach(buttonText => {
                const button = document.createElement('button');
                button.className = 'quick-btn';
                button.textContent = buttonText;
                button.onclick = () => sendQuickMessage(buttonText);
                quickButtonsContainer.appendChild(button);
            });
        }

        function addMessage(message, isUser = false) {
            const messagesContainer = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isUser ? 'user' : 'bot'}`;

            const avatar = document.createElement('div');
            avatar.className = 'avatar';
            avatar.textContent = isUser ? 'üë§' : 'üè•';

            const content = document.createElement('div');
            content.className = 'message-content';
            
            if (!isUser && message.includes('‚Ä¢')) {
                
                content.innerHTML = message.replace(/\n/g, '<br>');
            } else {
                content.textContent = message;
            }

            messageDiv.appendChild(avatar);
            messageDiv.appendChild(content);
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function addBotMessage(message) {
            addMessage(message, false);
        }

        function addUserMessage(message) {
            addMessage(message, true);
        }

        function showTyping() {
            const typingIndicator = document.getElementById('typingIndicator');
            typingIndicator.style.display = 'block';
            typingIndicator.querySelector('.typing-dots').textContent = getCurrentContent().typingText;
        }

        function hideTyping() {
            document.getElementById('typingIndicator').style.display = 'none';
        }

        // Get AI response from backend
        async function getAIResponse(userMessage) {
            try {
                const response = await fetch('http://localhost:5000/api/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        message: userMessage,
                        language: isHindi ? 'hi' : 'en',
                        user_id: 'web-user-' + Date.now()
                    })
                });
                
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                
                const data = await response.json();
                return data.response;
            } catch (error) {
                console.error('Error connecting to backend:', error);
                return generateResponse(userMessage.toLowerCase());
            }
        }

        // Updated AI response function
        function simulateAIResponse(userMessage) {
            showTyping();
            
            getAIResponse(userMessage)
                .then(response => {
                    hideTyping();
                    addBotMessage(response);
                    isConnected = true;
                    document.getElementById('connectionStatus').classList.remove('offline');
                })
                .catch(error => {
                    hideTyping();
                    const response = generateResponse(userMessage.toLowerCase());
                    addBotMessage(response + "\n\n‚ö†Ô∏è Using offline mode - some features may be limited");
                    isConnected = false;
                    document.getElementById('connectionStatus').classList.add('offline');
                });
        }

        function generateResponse(message) {
            const currentLang = isHindi ? 'hi' : 'en';
            
            if (message.includes('cold') || message.includes('‡§∏‡§∞‡•ç‡§¶‡•Ä')) {
                return healthDatabase.symptoms.cold[currentLang];
            }
            
            if (message.includes('fever') || message.includes('‡§¨‡•Å‡§ñ‡§æ‡§∞')) {
                return healthDatabase.symptoms.fever[currentLang];
            }
            
            if (message.includes('vaccination') || message.includes('‡§ü‡•Ä‡§ï‡§æ‡§ï‡§∞‡§£') || message.includes('vaccine')) {
                return createVaccinationCard(healthDatabase.vaccination.child[currentLang]);
            }
            
            if (message.includes('diabetes') || message.includes('‡§Æ‡§ß‡•Å‡§Æ‡•á‡§π')) {
                return createHealthCard("Diabetes Prevention | ‡§Æ‡§ß‡•Å‡§Æ‡•á‡§π ‡§ï‡•Ä ‡§∞‡•ã‡§ï‡§•‡§æ‡§Æ", healthDatabase.prevention.diabetes[currentLang]);
            }
            
            if (message.includes('blood pressure') || message.includes('‡§∞‡§ï‡•ç‡§§‡§ö‡§æ‡§™')) {
                return currentLang === 'hi' 
                    ? "‡§∞‡§ï‡•ç‡§§‡§ö‡§æ‡§™ ‡§ï‡•Ä ‡§ú‡§æ‡§Ç‡§ö:\n‚Ä¢ ‡§∏‡§æ‡§Æ‡§æ‡§®‡•ç‡§Ø: 120/80 mmHg ‡§∏‡•á ‡§ï‡§Æ\n‚Ä¢ ‡§®‡§ø‡§Ø‡§Æ‡§ø‡§§ ‡§ú‡§æ‡§Ç‡§ö ‡§ï‡§∞‡§æ‡§è‡§Ç\n‚Ä¢ ‡§ï‡§Æ ‡§®‡§Æ‡§ï ‡§ñ‡§æ‡§è‡§Ç\n‚Ä¢ ‡§µ‡•ç‡§Ø‡§æ‡§Ø‡§æ‡§Æ ‡§ï‡§∞‡•á‡§Ç\n‚Ä¢ ‡§§‡§®‡§æ‡§µ ‡§ï‡§Æ ‡§ï‡§∞‡•á‡§Ç"
                    : "Blood pressure monitoring:\n‚Ä¢ Normal: Less than 120/80 mmHg\n‚Ä¢ Regular checkups\n‚Ä¢ Reduce salt intake\n‚Ä¢ Exercise regularly\n‚Ä¢ Manage stress";
            }
            
            if (message.includes('first aid') || message.includes('‡§™‡•ç‡§∞‡§æ‡§•‡§Æ‡§ø‡§ï ‡§ö‡§ø‡§ï‡§ø‡§§‡•ç‡§∏‡§æ')) {
                return currentLang === 'hi'
                    ? "‡§™‡•ç‡§∞‡§æ‡§•‡§Æ‡§ø‡§ï ‡§ö‡§ø‡§ï‡§ø‡§§‡•ç‡§∏‡§æ ‡§Æ‡•Ç‡§≤ ‡§¨‡§æ‡§§‡•á‡§Ç:\n‚Ä¢ ‡§ò‡§æ‡§µ ‡§ï‡•ã ‡§∏‡§æ‡§´ ‡§™‡§æ‡§®‡•Ä ‡§∏‡•á ‡§ß‡•ã‡§è‡§Ç\n‚Ä¢ ‡§¶‡§¨‡§æ‡§µ ‡§°‡§æ‡§≤‡§ï‡§∞ ‡§ñ‡•Ç‡§® ‡§∞‡•ã‡§ï‡•á‡§Ç\n‚Ä¢ ‡§ú‡§≤‡§®‡•á ‡§™‡§∞ ‡§†‡§Ç‡§°‡§æ ‡§™‡§æ‡§®‡•Ä ‡§≤‡§ó‡§æ‡§è‡§Ç\n‚Ä¢ ‡§¨‡•á‡§π‡•ã‡§∂‡•Ä ‡§Æ‡•á‡§Ç ‡§µ‡•ç‡§Ø‡§ï‡•ç‡§§‡§ø ‡§ï‡•ã ‡§ï‡§∞‡§µ‡§ü ‡§™‡§∞ ‡§≤‡§ø‡§ü‡§æ‡§è‡§Ç\n‚Ä¢ ‡§ó‡§Ç‡§≠‡•Ä‡§∞ ‡§∏‡•ç‡§•‡§ø‡§§‡§ø ‡§Æ‡•á‡§Ç 108 ‡§™‡§∞ ‡§ï‡•â‡§≤ ‡§ï‡§∞‡•á‡§Ç"
                    : "First aid basics:\n‚Ä¢ Clean wounds with water\n‚Ä¢ Apply pressure to stop bleeding\n‚Ä¢ Use cold water for burns\n‚Ä¢ Place unconscious person in recovery position\n‚Ä¢ Call 108 for serious conditions";
            }
            
            return currentLang === 'hi'
                ? "‡§Æ‡•Å‡§ù‡•á ‡§ñ‡•Å‡§∂‡•Ä ‡§π‡•ã‡§ó‡•Ä ‡§Ü‡§™‡§ï‡•Ä ‡§Æ‡§¶‡§¶ ‡§ï‡§∞‡§®‡•á ‡§Æ‡•á‡§Ç! ‡§ï‡•É‡§™‡§Ø‡§æ ‡§Ö‡§ß‡§ø‡§ï ‡§µ‡§ø‡§∂‡§ø‡§∑‡•ç‡§ü ‡§™‡•ç‡§∞‡§∂‡•ç‡§® ‡§™‡•Ç‡§õ‡•á‡§Ç ‡§ú‡•à‡§∏‡•á ‡§ï‡§ø ‡§≤‡§ï‡•ç‡§∑‡§£, ‡§ü‡•Ä‡§ï‡§æ‡§ï‡§∞‡§£, ‡§Ø‡§æ ‡§∞‡•ã‡§ï‡§•‡§æ‡§Æ ‡§ï‡•á ‡§¨‡§æ‡§∞‡•á ‡§Æ‡•á‡§Ç‡•§ ‡§Ü‡§™ ‡§ä‡§™‡§∞ ‡§¶‡§ø‡§è ‡§ó‡§è ‡§¨‡§ü‡§® ‡§ï‡§æ ‡§≠‡•Ä ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç‡•§"
                : "I'd be happy to help you! Please ask more specific questions about symptoms, vaccination schedules, or prevention tips. You can also use the quick buttons above.";
        }

        function createHealthCard(title, content) {
            return `üìã ${title}\n\n${content}`;
        }

        function createVaccinationCard(content) {
            return `üíâ Vaccination Schedule | ‡§ü‡•Ä‡§ï‡§æ‡§ï‡§∞‡§£ ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ\n\n${content}`;
        }

        function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (message === '') return;
            
            addUserMessage(message);
            input.value = '';
            
            chatHistory.push({user: message, timestamp: new Date()});
            
            simulateAIResponse(message);
        }

        function sendQuickMessage(message) {
            document.getElementById('chatInput').value = message;
            sendMessage();
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        window.onload = async function() {
            await initializeChatbot();
            addEmergencyButton();
        };

        setInterval(() => {
            if (Math.random() < 0.1 && chatHistory.length > 0 && isConnected) {
                showPeriodicHealthTip();
            }
        }, 45000); 

        function monitorNetworkStatus() {
            setInterval(async () => {
                try {
                    const response = await fetch('http://localhost:5000/api/health-tips?lang=en', { 
                        method: 'HEAD',
                        signal: AbortSignal.timeout(5000) // 5 second timeout
                    });
                    
                    if (response.ok && !isConnected) {
                        isConnected = true;
                        document.getElementById('connectionStatus').classList.remove('offline');
                        addBotMessage(isHindi ? 
                            "‚úÖ ‡§¨‡•à‡§ï‡§è‡§Ç‡§° ‡§∏‡•á ‡§ï‡§®‡•á‡§ï‡•ç‡§∂‡§® ‡§™‡•Å‡§®‡§∞‡•ç‡§∏‡•ç‡§•‡§æ‡§™‡§ø‡§§!" : 
                            "‚úÖ Backend connection restored!");
                    }
                } catch (error) {
                    if (isConnected) {
                        isConnected = false;
                        document.getElementById('connectionStatus').classList.add('offline');
                        addBotMessage(isHindi ? 
                            "‚ö†Ô∏è ‡§¨‡•à‡§ï‡§è‡§Ç‡§° ‡§ï‡§®‡•á‡§ï‡•ç‡§∂‡§® ‡§ñ‡•ã ‡§ó‡§Ø‡§æ - ‡§ë‡§´‡§≤‡§æ‡§á‡§® ‡§Æ‡•ã‡§° ‡§Æ‡•á‡§Ç ‡§∏‡•ç‡§µ‡§ø‡§ö ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à" : 
                            "‚ö†Ô∏è Backend connection lost - switching to offline mode");
                    }
                }
            }, 30000);
        }

        async function searchDiseases(query) {
            try {
                const lang = isHindi ? 'hi' : 'en';
                const response = await fetch(`http://localhost:5000/api/diseases?q=${encodeURIComponent(query)}&lang=${lang}`);
                const data = await response.json();
                return data.diseases;
            } catch (error) {
                console.error('Error searching diseases:', error);
                return [];
            }
        }

        async function getVaccinations(ageGroup = '') {
            try {
                const lang = isHindi ? 'hi' : 'en';
                const response = await fetch(`http://localhost:5000/api/vaccinations?age_group=${encodeURIComponent(ageGroup)}&lang=${lang}`);
                const data = await response.json();
                return data.vaccinations;
            } catch (error) {
                console.error('Error fetching vaccinations:', error);
                return [];
            }
        }

        async function getHealthTips() {
            try {
                const lang = isHindi ? 'hi' : 'en';
                const response = await fetch(`http://localhost:5000/api/health-tips?lang=${lang}`);
                const data = await response.json();
                return data.tips;
            } catch (error) {
                console.error('Error fetching health tips:', error);
                return [];
            }
        }

        async function getEmergencyInfo() {
            try {
                const lang = isHindi ? 'hi' : 'en';
                const response = await fetch(`http://localhost:5000/api/emergency?lang=${lang}`);
                const data = await response.json();
                return data;
            } catch (error) {
                console.error('Error fetching emergency info:', error);
                return null;
            }
        }

        async function sendQuickMessageWithAPI(message) {
            document.getElementById('chatInput').value = message;
            
            if (message.includes('Vaccination') || message.includes('‡§ü‡•Ä‡§ï‡§æ‡§ï‡§∞‡§£')) {
                try {
                    showTyping();
                    const vaccines = await getVaccinations();
                    hideTyping();
                    
                    if (vaccines.length > 0) {
                        let response = isHindi ? 
                            "‡§Ø‡§π‡§æ‡§Å ‡§ü‡•Ä‡§ï‡§æ‡§ï‡§∞‡§£ ‡§ï‡•Ä ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§π‡•à:\n\n" : 
                            "Here's the vaccination information:\n\n";
                        
                        vaccines.slice(0, 3).forEach(vaccine => {
                            response += `üî∏ ${vaccine.vaccine_name}\n`;
                            response += `   ${isHindi ? '‡§Ü‡§Ø‡•Å ‡§∏‡§Æ‡•Ç‡§π:' : 'Age group:'} ${vaccine.age_group}\n`;
                            response += `   ${isHindi ? '‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ:' : 'Schedule:'} ${vaccine.schedule}\n\n`;
                        });
                        
                        addUserMessage(message);
                        addBotMessage(response);
                        return;
                    }
                } catch (error) {
                    console.error('API call failed, falling back to regular chat');
                }
            }
            
            sendMessage();
        }

        async function initializeChatbot() {
            updateLanguage();
            
            try {
                const response = await fetch('http://localhost:5000/api/health-tips?lang=en');
                if (response.ok) {
                    isConnected = true;
                    document.getElementById('connectionStatus').classList.remove('offline');
                    addBotMessage(getCurrentContent().welcomeMessage + "\n\n‚úÖ Connected to AI backend");
                } else {
                    throw new Error('Backend not responding');
                }
            } catch (error) {
                isConnected = false;
                document.getElementById('connectionStatus').classList.add('offline');
                addBotMessage(getCurrentContent().welcomeMessage + "\n\n‚ö†Ô∏è Running in offline mode - limited functionality");
            }
            
            updateQuickButtons();
        }

        function updateQuickButtons() {
            const quickButtonsContainer = document.getElementById('quickButtons');
            const currentContent = getCurrentContent();
            
            quickButtonsContainer.innerHTML = '';
            currentContent.quickButtons.forEach(buttonText => {
                const button = document.createElement('button');
                button.className = 'quick-btn';
                button.textContent = buttonText;
                button.onclick = () => isConnected ? 
                    sendQuickMessageWithAPI(buttonText) : 
                    sendQuickMessage(buttonText);
                quickButtonsContainer.appendChild(button);
            });
        }

        function addEmergencyButton() {
            const quickButtonsContainer = document.getElementById('quickButtons');
            const emergencyBtn = document.createElement('button');
            emergencyBtn.className = 'quick-btn';
            emergencyBtn.style.background = 'linear-gradient(135deg, #f44336 0%, #d32f2f 100%)';
            emergencyBtn.textContent = isHindi ? 'üö® ‡§Ü‡§™‡§æ‡§§‡§ï‡§æ‡§≤' : 'üö® Emergency';
            emergencyBtn.onclick = showEmergencyInfo;
            quickButtonsContainer.appendChild(emergencyBtn);
        }
        async function showEmergencyInfo() {
            try {
                const emergencyData = await getEmergencyInfo();
                if (emergencyData) {
                    const message = `üö® ${isHindi ? '‡§Ü‡§™‡§æ‡§§‡§ï‡§æ‡§≤‡•Ä‡§® ‡§∏‡§Ç‡§™‡§∞‡•ç‡§ï:' : 'Emergency Contacts:'}\n\n` +
                        `üöë ${isHindi ? '‡§è‡§Æ‡•ç‡§¨‡•Å‡§≤‡•á‡§Ç‡§∏:' : 'Ambulance:'} ${emergencyData.ambulance}\n` +
                        `üëÆ ${isHindi ? '‡§™‡•Å‡§≤‡§ø‡§∏:' : 'Police:'} ${emergencyData.police}\n` +
                        `üöí ${isHindi ? '‡§´‡§æ‡§Ø‡§∞:' : 'Fire:'} ${emergencyData.fire}\n\n` +
                        emergencyData.message;
                    
                    addBotMessage(message);
                } else {
                    const fallback = isHindi ?
                        "üö® ‡§Ü‡§™‡§æ‡§§‡§ï‡§æ‡§≤‡•Ä‡§® ‡§∏‡§Ç‡§™‡§∞‡•ç‡§ï:\nüöë ‡§è‡§Æ‡•ç‡§¨‡•Å‡§≤‡•á‡§Ç‡§∏: 108\nüëÆ ‡§™‡•Å‡§≤‡§ø‡§∏: 100\nüöí ‡§´‡§æ‡§Ø‡§∞: 101" :
                        "üö® Emergency Contacts:\nüöë Ambulance: 108\nüëÆ Police: 100\nüöí Fire: 101";
                    addBotMessage(fallback);
                }
            } catch (error) {
                const fallback = isHindi ?
                    "üö® ‡§Ü‡§™‡§æ‡§§‡§ï‡§æ‡§≤ ‡§Æ‡•á‡§Ç ‡§§‡•Å‡§∞‡§Ç‡§§ 108 ‡§™‡§∞ ‡§ï‡•â‡§≤ ‡§ï‡§∞‡•á‡§Ç!" :
                    "üö® For emergencies, call 108 immediately!";
                addBotMessage(fallback);
            }
        }

        async function showPeriodicHealthTip() {
            try {
                const tips = await getHealthTips();
                if (tips && tips.length > 0) {
                    const randomTip = tips[Math.floor(Math.random() * tips.length)];
                    addBotMessage(`üí° ${isHindi ? '‡§∏‡•ç‡§µ‡§æ‡§∏‡•ç‡§•‡•ç‡§Ø ‡§∏‡•Å‡§ù‡§æ‡§µ:' : 'Health Tip:'} ${randomTip}`);
                }
            } catch (error) {
                const localTips = [
                    {
                        en: "üí° Health Tip: Drink at least 8 glasses of water daily to stay hydrated!",
                        hi: "üí° ‡§∏‡•ç‡§µ‡§æ‡§∏‡•ç‡§•‡•ç‡§Ø ‡§∏‡•Å‡§ù‡§æ‡§µ: ‡§π‡§æ‡§á‡§°‡•ç‡§∞‡•á‡§ü‡•á‡§° ‡§∞‡§π‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§¶‡§ø‡§® ‡§Æ‡•á‡§Ç ‡§ï‡§Æ ‡§∏‡•á ‡§ï‡§Æ 8 ‡§ó‡§ø‡§≤‡§æ‡§∏ ‡§™‡§æ‡§®‡•Ä ‡§™‡§ø‡§è‡§Ç!"
                    },
                    {
                        en: "üí° Health Tip: Wash your hands frequently to prevent infections!",
                        hi: "üí° ‡§∏‡•ç‡§µ‡§æ‡§∏‡•ç‡§•‡•ç‡§Ø ‡§∏‡•Å‡§ù‡§æ‡§µ: ‡§∏‡§Ç‡§ï‡•ç‡§∞‡§Æ‡§£ ‡§∏‡•á ‡§¨‡§ö‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ö‡§™‡§®‡•á ‡§π‡§æ‡§• ‡§¨‡§æ‡§∞-‡§¨‡§æ‡§∞ ‡§ß‡•ã‡§è‡§Ç!"
                    }
                ];
                
                const randomTip = localTips[Math.floor(Math.random() * localTips.length)];
                const currentLang = isHindi ? 'hi' : 'en';
                addBotMessage(randomTip[currentLang]);
            }
        }
        setTimeout(monitorNetworkStatus, 10000); // Start after 10 seconds
    </script>
</body>
</html>